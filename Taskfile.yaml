version: '3'
vars:
  DOCKER_IMAGE: ghcr.io/codeteam2-dev/echo:latest
tasks:
  setup:
    cmds:
    - brew install goreleaser/tap/goreleaser
    - brew install ko
  build:
    cmds:
    #- docker build -t {{ .DOCKER_IMAGE }} -f Dockerfile .
    - goreleaser build -f .goreleaser.yaml
  run:
    cmds:
    - docker run -it --rm {{ .DOCKER_IMAGE }}
  publish:
    cmds:
    - docker push {{ .DOCKER_IMAGE }}
  release:
    cmds:
    - goreleaser release -f .goreleaser.yaml